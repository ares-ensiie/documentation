<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <link href="/assets/stylesheets/documentation.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/assets/javascripts/documentation.js" type="text/javascript"></script>
    <link rel="icon" type="image/png" href="https://s3-eu-west-1.amazonaws.com/ares-favicon/favicon.png">
  </head>
  <body class='admins admins_services admins_services_hebergement admins_services_hebergement_index'>
    <header class='notice'>
      <p>En cas de problème avec la documentation, veuillez <a href="https://github.com/ares-ensiie/documentation/issues/new">ouvrir une issue</a> ou nous contacter sur <a href="irc://irc.iiens.net/%23ares">#ares</a> ou <a href="mailto:ares@ares-ensiie.eu">ares@ares-ensiie.eu</a>. Suivez-nous sur <a href="https://github.com/ares-ensiie">github</a>!</p>
    </header>
    <article>
      <h1>Hébergement d&#39;un site web sur les serveurs d&#39;ARES (non PaaS)</h1>&#x000A;&#x000A;<h2>Base de données</h2>&#x000A;&#x000A;<p>Sur <code>castel</code>: si le fichier <code>mysql.secret</code> n&#39;existe pas, le créer.</p>&#x000A;&#x000A;<p>Ensuite:</p>&#x000A;<div class="highlight"><pre><span class="n">chmod</span> <span class="mi">700</span> <span class="n">mysql</span><span class="p">.</span><span class="n">secret</span>&#x000A;</pre></div>&#x000A;<p>Puis aller sur <code>chef-server</code> pour récupérer le mot de passe de bertha.</p>&#x000A;&#x000A;<p>Enfin, aller dans <code>ares-dbtools</code> et faire:</p>&#x000A;<div class="highlight"><pre><span class="n">sudo</span> <span class="p">.</span><span class="o">/</span><span class="n">new_db</span><span class="p">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">t</span> <span class="n">MySQL</span> <span class="o">-</span><span class="n">u</span> <span class="n">username</span>&#x000A;</pre></div>&#x000A;<p>où <code>username</code> est le nom d&#39;utilisateur du bénéficiaire de la base de données, par exemple <code>unbekandt2011</code>.</p>&#x000A;&#x000A;<p>Remarques: </p>&#x000A;&#x000A;<ul>&#x000A;<li>Ce script doit être exécuté en tant qu&#39;administrateur</li>&#x000A;<li>Pour afficher l&#39;aide, lancer le script sans arguments</li>&#x000A;<li>Deux types de bases de données sont actuellement disponibles: MySQL et PgSQL</li>&#x000A;<li>Le mot de passe (généré aléatoirement) est envoyé au demandeur de la base de données par mail automatiquement</li>&#x000A;</ul>&#x000A;&#x000A;<h2>Hébergement web</h2>&#x000A;&#x000A;<p>Se connecter à <code>cachiri</code>. Exemple:</p>&#x000A;<div class="highlight"><pre> <span class="n">ssh</span> <span class="n">heckel2012</span><span class="err">@</span><span class="n">cachiri</span> &#x000A;</pre></div>&#x000A;<p>Puis aller dans le dossier adéquat:</p>&#x000A;<div class="highlight"><pre><span class="n">cd</span> <span class="n">etc</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">sites</span><span class="o">-</span><span class="n">available</span>&#x000A;</pre></div>&#x000A;<p>Ensuite, créer le virtual host (VHOST):</p>&#x000A;<div class="highlight"><pre><span class="n">touch</span> <span class="n">nomDeDomaineDuSite</span>&#x000A;</pre></div>&#x000A;<p>Exemple:</p>&#x000A;<div class="highlight"><pre><span class="n">touch</span> <span class="n">drinkiit</span>&#x000A;</pre></div>&#x000A;<p>Puis créer le dossier de logs:</p>&#x000A;<div class="highlight"><pre><span class="n">cd</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">apache2</span>&#x000A;<span class="n">mkdir</span> <span class="n">nomDeDomaineDuSite</span><span class="p">.</span><span class="n">iiens</span><span class="p">.</span><span class="n">eu</span>&#x000A;</pre></div>&#x000A;<p>Apache créera dans ce dossier les fichiers <code>error.log</code> (fichier de logs d&#39;erreur) et <code>acces.log</code> (fichier de logs des connexions au site).&#x000A;Exemple:</p>&#x000A;<div class="highlight"><pre><span class="n">mkdir</span> <span class="n">drinkiit</span><span class="p">.</span><span class="n">iiens</span><span class="p">.</span><span class="n">eu</span>&#x000A;</pre></div>&#x000A;<p>Enfin:</p>&#x000A;<div class="highlight"><pre><span class="n">sudo</span> <span class="n">a2ensite</span>&#x000A;&#x000A;<span class="n">sudo</span> <span class="n">service</span> <span class="n">apache2</span> <span class="n">reload</span>&#x000A;</pre></div>&#x000A;<h2>OVH</h2>&#x000A;&#x000A;<p>Dernière étape: ajouter le CNAME sur ovh.</p>&#x000A;&#x000A;<p>Chercher le mot de passe sur la keychain puis aller sur <a href="https://www.ovh.com/managerv3/">ovh.com</a>, se connecter, et faire: </p>&#x000A;<div class="highlight"><pre><span class="o">-&gt;</span> <span class="n">Choisir</span> <span class="n">un</span> <span class="n">produit</span> <span class="p">(</span><span class="n">choisir</span> <span class="n">le</span> <span class="n">domaine</span> <span class="n">en</span> <span class="n">question</span><span class="p">,</span> <span class="n">par</span> <span class="n">exemple</span> <span class="n">iiens</span><span class="p">.</span><span class="n">eu</span><span class="p">)</span>&#x000A;<span class="o">-&gt;</span> <span class="n">Domaines</span> <span class="n">et</span> <span class="n">DNS</span>&#x000A;<span class="o">-&gt;</span> <span class="n">Zone</span> <span class="n">DNS</span>&#x000A;<span class="o">-&gt;</span> <span class="n">Type</span> <span class="n">CNAME</span>&#x000A;</pre></div>&#x000A;<p>Enfin remplir dans le champ <code>sous-domaine</code> le nom de domaine en question, par exemple <code>drinkiit</code>.&#x000A;Dans le champ <code>destination</code>, ne rien mettre.</p>&#x000A;&#x000A;<p>Il peut falloir jusqu&#39;à une heure pour que cette manipulation prenne effet.</p>&#x000A;&#x000A;<h2>Erreurs</h2>&#x000A;&#x000A;<p>Lorsqu&#39;une erreur survient, il faut faire:</p>&#x000A;<div class="highlight"><pre><span class="n">cd</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">apache2</span>&#x000A;<span class="n">cat</span> <span class="n">error</span><span class="p">.</span><span class="n">log</span>&#x000A;</pre></div>&#x000A;<p>A la fin de ce fichier se trouvent les erreurs les plus récentes.</p>&#x000A;&#x000A;<h3>Erreurs fréquentes</h3>&#x000A;&#x000A;<ul>&#x000A;<li><p>Oublier de relancer Apache/recharger la configuration d&#39;Apache:</p>&#x000A;<div class="highlight"><pre>    <span class="n">sudo</span> <span class="n">service</span> <span class="n">apache2</span> <span class="n">restart</span>&#x000A;</pre></div>&#x000A;<p>ou</p>&#x000A;<div class="highlight"><pre><span class="n">sudo</span> <span class="n">service</span> <span class="n">apache2</span> <span class="n">reload</span>&#x000A;</pre></div></li>&#x000A;<li><p>Créer un fichier et non un dossier pour les logs</p></li>&#x000A;<li><p>Créer un dossier pour les logs ne portant pas le bon nom</p></li>&#x000A;</ul>
    </article>
  </body>
</html>
